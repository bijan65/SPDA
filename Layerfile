#Use an Ubuntu 18.04 base for our staging server
FROM vm/ubuntu:18.04

# You could also install & start a database:
# RUN apt-get update && apt-get install postgresql

wget https://www.python.org/ftp/python/3.11.2/Python-3.11.2.tgz
tar -xf Python-3.11.2.tgz
cd Python-3.11.2
apt-get install -y pkg-config
./configure --enable-optimizations
make -j 6
sudo make altinstall
python3.11 -m pip install --upgrade pip

cd
mkdir SP
cd SP
wget https://github.com/freshremix/SPDBT/archive/refs/heads/heroku.zip
apt install unzip
unzip heroku.zip
cd SPDBT-heroku

sudo apt-get install -y libsqlite3-dev
sudo apt-get install git
sudo apt install curl
curl -fsSL https://deb.nodesource.com/setup_16.x | sudo bash -
curl -fsSL https://deb.nodesource.com/setup_14.x | sudo bash -
sudo apt install -y nodejs vim
sudo apt install gcc g++ make
curl -sL https://dl.yarnpkg.com/debian/pubkey.gpg | gpg --dearmor | sudo tee /usr/share/keyrings/yarnkey.gpg >/dev/null
echo "deb [signed-by=/usr/share/keyrings/yarnkey.gpg] https://dl.yarnpkg.com/debian stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
sudo apt update && sudo apt install yarn
sudo apt install build-essential zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev libreadline-dev libffi-dev libsqlite3-dev wget libbz2-dev

pip3.11 install -r requirements.txt
python3.11 main.py

# Expose the webserver in the staging server as a secure link.
# Whenever someone clicks the link, we'll load this staging server and forward
# their requests to it.
RUN BACKGROUND python3.11 -m http.server 80
EXPOSE WEBSITE http://localhost:80
